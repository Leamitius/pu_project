<!DOCTYPE html>
<html>

<head>
    <title>Expandable Google Mini Map</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            background-color: #f3f4f6;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        /* Container for the mini map */
        #minimap-container {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 250px;
            height: 200px;
            border: 2px solid #e5e7eb;
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.15s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            cursor: pointer;
            transform-origin: bottom right;
        }

        /* Expand on hover */
        #minimap-container:hover {
            width: 500px;
            /* Double the original width */
            height: 400px;
            /* Double the original height */
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
        }

        /* Make sure the map fills the container */
        #minimap {
            width: 100%;
            height: 100%;
        }

        .pin {
            width: 20px;
            height: 20px;
            background-color: #ffffff;
            transform: translate(0, 50%);
            border-radius: 50%;
            border-color: black;
            border-width: 1px;
        }
    </style>
</head>

<body class="bg-gray-100 flex flex-col justify-center items-center h-screen p-8">

    <div class="flex flex-col items-center justify-center p-8 bg-white rounded-xl shadow-lg w-full max-w-lg">
        <h1 class="text-3xl font-bold text-gray-800 mb-4">Guess the Country</h1>
        <p class="text-lg text-gray-600 mb-6 text-center" id="current-country-text">Click on the mini map to place your
            guess!</p>

        <button id="find-address-btn"
            class="px-6 py-3 bg-blue-600 text-white font-semibold rounded-full shadow-md hover:bg-blue-700 transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
            Check Guess
        </button>

        <div id="address-result" class="mt-6 text-gray-700 text-center text-sm p-4 bg-gray-50 rounded-lg w-full hidden">
            <span id="address-text"></span>
        </div>
    </div>

    <div id="minimap-container">
        <div id="minimap"></div>
    </div>

    <!-- Script -->
    <script>
        let minimap;
        let marker = null;
        let geocoder;
        let currentCountry = null; // object { name, iso2 }

        // 20 big countries with ISO-3166 alpha-2 codes (iso2)
        const countries = [
            { name: "United States", iso2: "US" },
            { name: "Canada", iso2: "CA" },
            { name: "Brazil", iso2: "BR" },
            { name: "United Kingdom", iso2: "GB" },
            { name: "France", iso2: "FR" },
            { name: "Germany", iso2: "DE" },
            { name: "Russia", iso2: "RU" },
            { name: "China", iso2: "CN" },
            { name: "India", iso2: "IN" },
            { name: "Australia", iso2: "AU" },
            { name: "Mexico", iso2: "MX" },
            { name: "Japan", iso2: "JP" },
            { name: "Italy", iso2: "IT" },
            { name: "Spain", iso2: "ES" },
            { name: "South Africa", iso2: "ZA" },
            { name: "Egypt", iso2: "EG" },
            { name: "Argentina", iso2: "AR" },
            { name: "Saudi Arabia", iso2: "SA" },
            { name: "Turkey", iso2: "TR" },
            { name: "Indonesia", iso2: "ID" }
        ];

        // Pick a random country and update UI
        function pickRandomCountry() {
            currentCountry = countries[Math.floor(Math.random() * countries.length)];
            document.getElementById("current-country-text").textContent = `Find: ${currentCountry.name}`;
        }

        // Custom SVG marker (your original)
        const pinSvgString = '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 56 56" fill="none"><rect width="56" height="56" rx="28" fill="#7837FF"></rect><path d="M46.0675 22.1319L44.0601 22.7843" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M11.9402 33.2201L9.93262 33.8723" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M27.9999 47.0046V44.8933" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M27.9999 9V11.1113" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M39.1583 43.3597L37.9186 41.6532" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M16.8419 12.6442L18.0816 14.3506" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M9.93262 22.1319L11.9402 22.7843" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M46.0676 33.8724L44.0601 33.2201" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M39.1583 12.6442L37.9186 14.3506" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M16.8419 43.3597L18.0816 41.6532" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M28 39L26.8725 37.9904C24.9292 36.226 23.325 34.7026 22.06 33.4202C20.795 32.1378 19.7867 30.9918 19.035 29.9823C18.2833 28.9727 17.7562 28.0587 17.4537 27.2401C17.1512 26.4216 17 25.5939 17 24.7572C17 23.1201 17.5546 21.7513 18.6638 20.6508C19.7729 19.5502 21.1433 19 22.775 19C23.82 19 24.7871 19.2456 25.6762 19.7367C26.5654 20.2278 27.34 20.9372 28 21.8649C28.77 20.8827 29.5858 20.1596 30.4475 19.6958C31.3092 19.2319 32.235 19 33.225 19C34.8567 19 36.2271 19.5502 37.3362 20.6508C38.4454 21.7513 39 23.1201 39 24.7572C39 25.5939 38.8488 26.4216 38.5463 27.2401C38.2438 28.0587 37.7167 28.9727 36.965 29.9823C36.2133 30.9918 35.205 32.1378 33.94 33.4202C32.675 34.7026 31.0708 36.226 29.1275 37.9904L28 39Z" fill="#FF7878"></path></svg>';
        const parser = new DOMParser();
        const pinSvg = parser.parseFromString(pinSvgString, 'image/svg+xml').documentElement;

        // Initialize the mini map and add click functionality (keeps AdvancedMarkerElement)
        function initMiniMap() {
            const { Map } = google.maps;
            const { AdvancedMarkerElement } = google.maps.marker;
            const Geocoder = google.maps.Geocoder;

            minimap = new Map(document.getElementById("minimap"), {
                center: { lat: 0, lng: 0 },
                zoom: 2,
                disableDefaultUI: true,
                mapId: "df542bd3de8453454abd37a7",
                clickableIcons: false
            });

            geocoder = new Geocoder();

            minimap.addListener("click", (mapsMouseEvent) => {
                const clickedLocation = mapsMouseEvent.latLng;

                // remove previous marker if present
                if (marker) {
                    marker.map = null;
                }
                const pin = document.createElement('div');
                pin.className = 'pin';

                marker = new AdvancedMarkerElement({
                    position: clickedLocation,
                    map: minimap,
                    content: pin,
                    title: 'Your guess!',

                });

                // hide previous result
                document.getElementById("address-result").classList.add("hidden");
                document.getElementById("address-text").textContent = '';
            });

            pickRandomCountry();
        }

        // Reverse geocode using Nominatim and request English results
        async function getCountry(lat, lng) {
            try {
                const url = `https://nominatim.openstreetmap.org/reverse?format=jsonv2&addressdetails=1&accept-language=en&lat=${lat}&lon=${lng}`;
                const res = await fetch(url, {
                    headers: {
                        // polite user-agent is recommended when using Nominatim in dev/demo
                        'User-Agent': 'GeoGuessr-Demo/1.0 (your-email@example.com)'
                    }
                });
                const data = await res.json();
                console.log(data);
                // Nominatim returns address.country and address.country_code (alpha2, lowercase)
                return {
                    countryName: data.address?.country || null,
                    countryCode: data.address?.country_code ? data.address.country_code.toUpperCase() : null
                };
            } catch (e) {
                console.error("Nominatim error:", e);
                return { countryName: null, countryCode: null };
            }
        }

        // Check guess when user clicks button
        document.getElementById("find-address-btn").addEventListener("click", async () => {
            if (!marker) {
                document.getElementById("address-text").textContent = "Please click on the map to place a marker first!";
                document.getElementById("address-result").classList.remove("hidden");
                return;
            }

            const pos = marker.position.toJSON();
            const { countryName, countryCode } = await getCountry(pos.lat, pos.lng);
            const resultDiv = document.getElementById("address-result");

            // Compare ISO alpha-2 codes (we store iso2 as uppercase)
            if (countryCode && currentCountry && countryCode === currentCountry.iso2.toUpperCase()) {
                resultDiv.innerHTML = `✅ Correct! You found ${currentCountry.name} (${countryName || countryCode}).`;
                // pick a new country after correct guess
                pickRandomCountry();
            } else {
                // Show what was clicked, in English (because accept-language=en)
                const clickedLabel = countryName ? `${countryName} (${countryCode || 'code unknown'})` : 'an unknown area';
                resultDiv.innerHTML = `❌ Wrong — you clicked in ${clickedLabel}. Target: ${currentCountry.name}. Try again.`;
            }

            resultDiv.classList.remove("hidden");
        });

        // Google Maps API callback
        function initMap() {
            initMiniMap();
        }
        window.initMap = initMap;
    </script>

    <script async
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBr5qBdwGAkn-sJRlvgewmETYU8obe4gtY&v=weekly&callback=initMap&libraries=marker"></script>
</body>
</body>

</html>